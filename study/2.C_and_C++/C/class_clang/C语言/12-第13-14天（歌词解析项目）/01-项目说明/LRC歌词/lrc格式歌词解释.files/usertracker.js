var userTracker={request:getXMLHttpRequest(),beginTime:0,sid:null,urlStr:"/stat/stat=1",lemmaContent:null,navigatorName:getNavigatorName()};var clicks=new Object();userTracker.urlStr+=getParam("navigator",userTracker.navigatorName);if(window.attachEvent){window.attachEvent("onload",statInitial);window.attachEvent("onunload",onPageClose)}else{window.addEventListener("load",statInitial,false);window.addEventListener("beforeunload",onPageClose,false)}function lemmaCreateEditEnd(){if(isLemmaCreatePage()==true||isLemmaEditPage()==true){userTracker.lemmaContent=getLemmaContent();var A=userTracker.lemmaContent?userTracker.lemmaContent.length:0;userTracker.urlStr+=getParam("afterlemmacontentlen",A);userTracker.urlStr+=getParam("aftelemmatitlecount",getSubstrCount(userTracker.lemmaContent,"[title]"))}}function onPageClose(){lemmaCreateEditEnd();var B=window.location.href;userTracker.urlStr+=getParam("refer",B);for(var A in clicks){userTracker.urlStr+=getParam(A,clicks[A])}var C=getStayTime();userTracker.urlStr+=getParam("staytime",C);userTracker.sid=getSID();userTracker.urlStr+=getParam("sid",userTracker.sid);userTracker.urlStr=userTracker.urlStr.replace(/\#/g,"");sendRequest(userTracker.urlStr,null,"GET",null)}function getNavigatorName(){if(navigator.userAgent.indexOf("MSIE")!=-1){return"MSIE"}else{if(navigator.userAgent.indexOf("Firefox")!=-1){return"Firefox"}else{return"other"}}}function getSubstrCount(C,B){if(!C||!B){return 0}var D=-1;var A=0;while((D=C.indexOf(B,D+1))!=-1){A++}return A}function statInitial(){userTracker.beginTime=new Date();if(isLemmaEditPage()==true||isLemmaCreatePage()==true){userTracker.lemmaContent=getLemmaContent();var A=userTracker.lemmaContent?userTracker.lemmaContent.length:0;userTracker.urlStr+=getParam("beforelemmacontentlen",A);userTracker.urlStr+=getParam("beforelemmatitlecount",getSubstrCount(userTracker.lemmaContent,"[title]"))}registerListeners("STAT_ONCLICK_SUBMIT_LEMMA","onclick",onclickLemmaSubmitListener);registerListeners("STAT_ONCLICK_SUBMIT_UC_WAITAUDIT","onclick",onclickASubmitListener);registerListeners("STAT_ONCLICK_SUBMIT_UC_UNPASS","onclick",onclickASubmitListener);registerListeners("STAT_ONCLICK_SUBMIT_UC_PASS","onclick",onclickASubmitListener);registerListeners("STAT_ONCLICK_UNSUBMIT_CATALOG","onclick",onclickListener);registerListeners("STAT_ONCLICK_UNSUBMIT_CATALOG_RETURN","onclick",onclickListener);registerListeners("STAT_ONCLICK_VIEW_COMMENT","onclick",onclickListener)}function onclickLemmaSubmitListener(){userTracker.urlStr+=getParam("lemmasubmit","true")}function getSeconds(B,A){return Math.round((B.getTime()-A.getTime())/1000)}function isLemmaCreatePage(){return(window.location.href.indexOf("/search_noitem/?word")==-1&&window.location.href.indexOf("/creat/")==-1)?false:true}function isLemmaEditPage(){return window.location.href.indexOf("/edit/")==-1?false:true}function getLemmaContent(){if(isLemmaEditPage()==false&&isLemmaCreatePage()==false){return null}var A=UBBEncode(editor.getHtml());if(A){return A}return null}function getLemmaContentLen(){var A=getLemmaContent();return A==null?0:A.length}function getStayTime(){return Math.round(((new Date()).getTime()-userTracker.beginTime.getTime())/1000)}function getEventSource(B){var A;if(userTracker.navigatorName=="MSIE"){A=window.event.srcElement}else{A=B.target}return A}function getParam(A,B){return"$"+A+"="+B}function onclickASubmitListener(B){var A=getEventSource(B);if(A.href&&A.href.lastIndexOf("#")==-1){userTracker.urlStr+=getParam("href",A.href);userTracker.urlStr+=getParam("sourceid",A.id)}}function onclickListener(B){var A=getEventSource(B);if(!clicks[A.id]){clicks[A.id]=1}else{clicks[A.id]++}}function registerListeners(observerName,listenType,listener){observers=document.getElementsByName(observerName);if(!observers||observers.length<=0){return false}for(i=0;i<observers.length;i++){eval("observers["+i+"]."+listenType+"="+listener);observers[i].setAttribute("id",observerName+"_"+i)}return true}function getSID(){var A="anonymous";if(document.cookie){var B=document.cookie.indexOf("BDUSS");if(B!=-1){var C=document.cookie.indexOf(";",B);A=C==-1?document.cookie.substr(B+6):document.cookie.substr(B+6,C-B-6)}}return A+"_"+Math.round(Math.random()*2147483637)+"_"+(new Date()).getTime()}function getXMLHttpRequest(){var A;if(window.XMLHttpRequest){A=new XMLHttpRequest()}else{if(window.ActiveXObject){A=new ActiveXObject("Microsoft.XMLHTTP")}}return A}function sendRequest(A,B,D,C){if(!userTracker.request){return false}if(!D){D="GET"}userTracker.request.open(D,A,false);userTracker.request.setRequestHeader("Content-Type","application/x-www-form-urlencoded");userTracker.request.send(B);return false};