<html>
<head>
<title>BusyBox 超级简化嵌入式 Linux 系统</title>




<meta http-equiv="Content-Type" content="text/html; charset=gb2312">
<style type="text/css">
<!--
.style1 {color: #0099cc}
-->
</style>
<link href='/Skin/DefaultSkin.css' rel='stylesheet' type='text/css'> <script language='JavaScript' type='text/JavaScript' src='/js/menu.js'></script>
<script type='text/javascript' language='JavaScript1.2' src='/js/stm31.js'></script>
<script language="JavaScript" type="text/JavaScript">
//改变图片大小
function resizepic(thispic)
{
if(thispic.width>700){thispic.height=thispic.height*700/thispic.width;thispic.width=700;} 
}
//无级缩放图片大小
function bbimg(o)
{
  var zoom=parseInt(o.style.zoom, 10)||100;
  zoom+=event.wheelDelta/12;
  if (zoom>0) o.style.zoom=zoom+'%';
  return false;
}
//双击鼠标滚动屏幕的代码
var currentpos,timer;
function initialize()
{
timer=setInterval ("scrollwindow ()",30);
}
function sc()
{
clearInterval(timer);
}
function scrollwindow()
{
currentpos=document.body.scrollTop;
window.scroll(0,++currentpos);
if (currentpos !=document.body.scrollTop)
sc();
}
document.onmousedown=sc
document.ondblclick=initialize

//更改字体大小
var status0='';
var curfontsize=10;
var curlineheight=18;
function fontZoomA(){
  if(curfontsize>8){
    document.getElementById('fontzoom').style.fontSize=(--curfontsize)+'pt';
	document.getElementById('fontzoom').style.lineHeight=(--curlineheight)+'pt';
  }
}
function fontZoomB(){
  if(curfontsize<64){
    document.getElementById('fontzoom').style.fontSize=(++curfontsize)+'pt';
	document.getElementById('fontzoom').style.lineHeight=(++curlineheight)+'pt';
  }
}
</script>
</head>
<body  oncontextmenu='return false' ondragstart='return false' onselectstart ='return false' onselect='document.selection.empty()' oncopy='document.selection.empty()' onbeforecopy='return false' onmouseup='document.selection.empty()'>
<div id=menuDiv style="Z-INDEX: 1000; VISIBILITY: hidden; WIDTH: 1px; POSITION: absolute; HEIGHT: 1px; BACKGROUND-COLOR: #9cc5f8">
</div>
<table height=114 cellSpacing=0 cellPadding=0 width=778 align=center background=/Skin/Ocean/top_bg.jpg border=0>
    <tr>
      <td width=213><a href='http://www.61ic.com/' title='61IC中国电子在线' target='_blank'><img src='http://www.61ic.com/images/logo.gif' width='213' height='114' border='0'></a></td>
      <td>
        <table cellSpacing=0 cellPadding=0 width="100%" border=0>
          <tr>
            <td colSpan=2 align="right">
              <table cellSpacing=0 cellPadding=0 align=right border=0>
                <tr>
                  <td><a href="/Announcelist.asp"><IMG height=25 src="/Skin/Ocean/Announce_01.jpg" border="0" alt="网站公告列表"></a></td>
                  <td class=showa width=280 background=/Skin/Ocean/Announce_02.jpg><MARQUEE onmouseover=this.stop() onmouseout=this.start() scrollAmount=1 scrollDelay=4 width=430 align="left"><p>&nbsp;&nbsp;没有公告</p>
                  </MARQUEE></td>
                </tr>
              </table>
            </td>
          </tr>
          <tr>
            <td width="83%" height=80><a href='http://www.61ic.com/' title='61IC中国电子在线'><img src='/Images/banner.gif' width='468' height='60' border='0'></a></td>
            <td width="17%">
              <table height=89 cellSpacing=0 cellPadding=0 width=94 background=/Skin/Ocean/topr.gif border=0>
                <tr>
                  <td align=middle colSpan=2>
                    <table height=56 cellSpacing=0 cellPadding=0 width=79 border=0>
                      <tr>
                        <td align=middle width=26><IMG height=13 src="/Skin/Ocean/arrows.gif" width=13></td>
                        <td width=68><A class=Bottom href="javascript:window.external.addFavorite('http://www.61ic.com/','61IC中国电子在线');">加入收藏</A></td>
                      </tr>
                      <tr>
                        <td align=middle><IMG height=13 src="/Skin/Ocean/arrows.gif" width=13></td>
                        <td><A class=Bottom onClick="this.style.behavior='url(#default#homepage)';this.setHomePage('http://www.61ic.com/');" href="#">设为首页</A></td>
                      </tr>
                      <tr>
                        <td align=middle><IMG height=13 src="/Skin/Ocean/arrows.gif" width=13></td>
                        <td><A class=Bottom href="mailto:web_61ic@163.com">联系站长</A></td>
                      </tr>
                    </table>
                  </td>
                </tr>
              </table>
            </td>
          </tr>
        </table>
      </td>
    </tr>
</table>
  <table cellSpacing=0 cellPadding=0 width=778 align=center border=0>
    <tr>
      <td class=menu_s align=middle>&nbsp;.&nbsp;<a class='Channel' href='/Index.html'>网站首页</a>&nbsp;.&nbsp;<a class='Channel'  href='/Product/Index.html' target='_blank' title=''>新品</a>&nbsp;.&nbsp;<a class='Channel'  href='/news/Index.html' target='_blank' title=''>新闻</a>&nbsp;.&nbsp;<a class='Channel2'  href='/Technology/Index.html' target='_blank' title=''>技术文库</a>&nbsp;.&nbsp;<a class='Channel'  href='/fanga/Index.html' target='_blank' title=''>解决方案</a>&nbsp;.&nbsp;<a class='Channel'  href='/UsePersonalIfluence/Index.html' target='_blank' title=''>活动专访</a>&nbsp;.&nbsp;<a class='Channel'  href='/Article/Index.html' target='_blank' title=''>DSP专栏</a>&nbsp;.&nbsp;<a class='Channel'  href='/Soft/Index.html' target='_blank' title=''>开源共享</a>&nbsp;.&nbsp;<a class='Channel'  href='/Services/Index.html' target='_blank' title=''>服务导航</a>&nbsp;.&nbsp;<a class='Channel'  href='/vip/Index.html' target='_blank' title=''>会员区</a>&nbsp;.&nbsp;<a class='Channel'  href='/Shop/Index.html' target='_blank' title=''>商城</a>&nbsp;.&nbsp;<a class='Channel'  href='http://www.61ic.com/Services/Government/Announcement/200712/17338.html' target='_blank' title=''>邮购须知</a>&nbsp;.&nbsp;<a class='Channel'  href='http://www.61ic.com/bbs/' target='_blank' title=''>社区</a>&nbsp;.&nbsp;</td>
    </tr>
    <tr>
      <td class=top_nav_menu><script language='JavaScript1.2' type='text/JavaScript' src='/Technology/JS/ShowClass_Menu.js'></script>
</td>
    </tr>
    <tr>
      <td><IMG height=7 src="/Skin/Ocean/menu_bg2.jpg" width=778></td>
    </tr>
    <tr>
      <td background=/Skin/Ocean/addr.jpg height=21>
        <table cellSpacing=0 cellPadding=0 width="100%" border=0>
          <tr>
<td align=middle width="5%"><IMG height=17 src="/Skin/Ocean/arrows2.gif" width=16></td>
      <td width="95%">您现在的位置：&nbsp;<a class='LinkPath' href='http://www.61ic.com/'>61IC中国电子在线</a>&nbsp;>>&nbsp;<a class='LinkPath' href='/Technology/Index.html'>技术文库</a>&nbsp;>>&nbsp;<a class='LinkPath' href='/Technology/embed/Index.html'>嵌入式</a>&nbsp;>>&nbsp;正文</td>
          </tr>
        </table>
      </td>
    </tr>
    <tr>
      <td background=/Skin/Ocean/addr_line.jpg height=4></td>
    </tr>
  </table> 
<div align=center>
<script language="javascript" src="/AD/200610/56.js"></script> 
</div>
<!-- ********网页中部代码开始******** -->
<!--文章显示代码开始-->
  <table class=center_tdbgall style="WORD-BREAK: break-all" cellSpacing=0 cellPadding=0 width=760 align=center border=0>
    <tr>
      <td colSpan=2>
        <table class=main_title_760 style="WORD-BREAK: break-all" cellSpacing=0 cellPadding=0 width="100%" border=0>
          <tr>
            <td vAlign=center width="4%">&nbsp;</td>
            <td width="65%"><STRONG><span class="S_headline1">[图文]</span>BusyBox&nbsp;超级简化嵌入式&nbsp;Linux&nbsp;系统</STRONG></td>
            <td width="18%"><FONT color=#ff0000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color='#009999'>★★★</font></FONT></td>
            <td align=right width="13%"><FONT color=#ff0000>【字体：<A href="javascript:fontZoomA();"><FONT color=#ff0000>小</FONT></A> <A href="javascript:fontZoomB();"><FONT color=#ff0000>大</FONT></A>】</FONT></td>
          </tr>
        </table>
      </td>
    </tr>
    <tr vAlign=center align=middle>
      <td class=main_ArticleTitle style="WORD-BREAK: break-all" colSpan=2 height=50>BusyBox&nbsp;超级简化嵌入式&nbsp;Linux&nbsp;系统</td>
    </tr>
    <tr vAlign=center align=middle>
      <td class=main_ArticleSubheading style="WORD-BREAK: break-all" colSpan=2></td>
    </tr>
    <tr align=middle>
      <td class=Article_tdbgall colSpan=2>作者：<a href='/ShowAuthor.asp?ChannelID=1024&AuthorName=61IC录入' title='61IC录入'>61IC录入</a>&nbsp;&nbsp;&nbsp;&nbsp;文章来源：本站原创&nbsp;&nbsp;&nbsp;&nbsp;点击数：<script language='javascript' src='/Technology/GetHits.asp?ArticleID=8075'></script>&nbsp;&nbsp;&nbsp;&nbsp;更新时间：2006-11-3&nbsp;&nbsp;&nbsp;&nbsp;<A title=收藏的网页将被永久地保存到新浪ViVi收藏夹http://vivi.sina.com.cn href="javascript:d=document;t=d.selection?(d.selection.type!='None'?d.selection.createRange().text:''):(d.getSelection?d.getSelection():'');void(vivi=window.open('http://vivi.sina.com.cn/collect/icollect.php?pid=2008&title='+escape(d.title)+'&url='+escape(d.location.href)+'&desc='+escape(t),'vivi','scrollbars=no,width=480,height=480,left=75,top=20,status=no,resizable=yes'));vivi.focus();"><IMG src="/images/vivi_coop1.gif" align=absMiddle border=0></A></td>
    </tr>
    <tr>
      <td class=main_tdbg_760 id=fontzoom style="WORD-BREAK: break-all" vAlign=top colSpan=2 height=300>
        <table cellSpacing=0 cellPadding=10 align=left border=0>
          <tr>
            <td>
            <!--插入广告JS代码--></td>
          </tr>
        </table>
&nbsp;
<P style="TEXT-INDENT: 2em">BusyBox 是很多标准 Linux&reg; 工具的一个单个可执行实现。BusyBox 包含了一些简单的工具，例如 cat 和 echo，还包含了一些更大、更复杂的工具，例如 grep、find、mount 以及 telnet（不过它的选项比传统的版本要少）；有些人将 BusyBox 称为 Linux 工具里的瑞士军刀。本文将探索 BusyBox 的目标，它是如何工作的，以及为什么它对于内存有限的环境来说是如此重要。 </P>
<P style="TEXT-INDENT: 2em"><B>BusyBox 的诞生</B> </P>
<P style="TEXT-INDENT: 2em">BusyBox 最初是由 Bruce Perens 在 1996 年为 Debian GNU/Linux 安装盘编写的。其目标是在一张软盘上创建一个可引导的 GNU/Linux 系统，这可以用作安装盘和急救盘。一张软盘可以保存大约 1.4-1.7MB 的内容，因此这里没有多少空间留给 Linux 内核以及相关的用户应用程序使用。 </P>
<P style="TEXT-INDENT: 2em">BusyBox 揭露了这样一个事实：很多标准 Linux 工具都可以共享很多共同的元素。例如，很多基于文件的工具（比如 grep 和 find）都需要在目录中搜索文件的代码。当这些工具被合并到一个可执行程序中时，它们就可以共享这些相同的元素，这样可以产生更小的可执行程序。实际上， BusyBox 可以将大约 3.5MB 的工具包装成大约 200KB 大小。这就为可引导的磁盘和使用 Linux 的嵌入式设备提供了更多功能。我们可以对 2.4 和 2.6 版本的 Linux 内核使用 BusyBox。 </P>
<P style="TEXT-INDENT: 2em"><B>BusyBox 是如何工作的？</B> </P>
<P style="TEXT-INDENT: 2em">为了让一个可执行程序看起来就像是很多可执行程序一样，BusyBox 为传递给 C 的 main 函数的参数开发了一个很少使用的特性。回想一下 C 语言的 main 函数的定义如下： </P>
<P style="TEXT-INDENT: 2em">清单 1. C 的 main 函数 </P>
<P style="TEXT-INDENT: 2em">
<CENTER><CCID_NOBR />
<TABLE cellSpacing=0 borderColorDark=#ffffff cellPadding=2 width=400 align=center borderColorLight=#000000 border=1>
<TBODY>
<TR>
<TD class=code style="FONT-SIZE: 9pt" bgColor=#e6e6e6><PRE><CCID_CODE />int main( int argc, char *argv[] )</CCID_CODE /></PRE></TD></TR></TBODY></TABLE></CCID_NOBR /></CENTER>
<P style="TEXT-INDENT: 2em">在这个定义中，argc 是传递进来的参数的个数（参数数量），而 argv 是一个字符串数组，代表从命令行传递进来的参数（参数向量）。argv 的索引 0 是从命令行调用的程序名。 </P>
<P style="TEXT-INDENT: 2em">清单 2 给出的这个简单 C 程序展示了 BusyBox 的调用。它只简单地打印 argv 向量的内容。 </P>
<P style="TEXT-INDENT: 2em">清单 2. BusyBox 使用 argv[0] 来确定调用哪个应用程序 </P>
<P style="TEXT-INDENT: 2em">
<CENTER><CCID_NOBR />
<TABLE cellSpacing=0 borderColorDark=#ffffff cellPadding=2 width=400 align=center borderColorLight=#000000 border=1>
<TBODY>
<TR>
<TD class=code style="FONT-SIZE: 9pt" bgColor=#e6e6e6><PRE><CCID_CODE />// test.c
#include &lt;stdio.h&gt;
int main( int argc, char *argv[] )
{
  int i;
  for (i = 0 ; i &lt; argc ; i++) {
    printf("argv[%d] = %s\n", i, argv[i]);
  }
  return 0;
}</CCID_CODE /></PRE></TD></TR></TBODY></TABLE></CCID_NOBR /></CENTER>
<P style="TEXT-INDENT: 2em">调用这个程序会显示所调用的第一个参数是该程序的名字。我们可以对这个可执行程序重新进行命名，此时再调用就会得到该程序的新名字。另外，我们可以创建一个到可执行程序的符号链接，在执行这个符号链接时，就可以看到这个符号链接的名字。 </P>
<P style="TEXT-INDENT: 2em">清单 3. 在使用新命令更新 BusyBox 之后的命令测试 </P>
<P style="TEXT-INDENT: 2em">
<CENTER><CCID_NOBR />
<TABLE cellSpacing=0 borderColorDark=#ffffff cellPadding=2 width=400 align=center borderColorLight=#000000 border=1>
<TBODY>
<TR>
<TD class=code style="FONT-SIZE: 9pt" bgColor=#e6e6e6><PRE><CCID_CODE />$ gcc -Wall -o test test.c
$ ./test arg1 arg2
argv[0] = ./test
argv[1] = arg1
argv[2] = arg2
$ mv test newtest
$ ./newtest arg1
argv[0] = ./newtest
argv[1] = arg1
$ ln -s newtest linktest
$ ./linktest arg
argv[0] = ./linktest
argv[1] = arg</CCID_CODE /></PRE></TD></TR></TBODY></TABLE></CENTER>
<P style="TEXT-INDENT: 2em">BusyBox 使用了符号链接以便使一个可执行程序看起来像很多程序一样。对于 BusyBox 中包含的每个工具来说，都会这样创建一个符号链接，这样就可以使用这些符号链接来调用 BusyBox 了。BusyBox 然后可以通过 argv[0] 来调用内部工具。 </P>
<P style="TEXT-INDENT: 2em"><B>配置并编译 BusyBox</B> </P>
<P style="TEXT-INDENT: 2em">我们可以从 BusyBox 的 Web 站点上下载最新版本的 BusyBox（请参看 参考资料 一节的内容）。与大部分开放源码程序一样，它是以一个压缩的 tarball 形式发布的，我们可以使用清单 4 给出的命令将其转换成源代码树。（如果我们下载的版本不是 1.1.1，那就请在这个命令中使用适当的版本号以及特定于这个版本号的命令。） </P>
<P style="TEXT-INDENT: 2em">清单 4. 展开 BusyBox </P>
<P style="TEXT-INDENT: 2em">
<CENTER><CCID_NOBR />
<TABLE cellSpacing=0 borderColorDark=#ffffff cellPadding=2 width=400 align=center borderColorLight=#000000 border=1>
<TBODY>
<TR>
<TD class=code style="FONT-SIZE: 9pt" bgColor=#e6e6e6><PRE><CCID_CODE />$ tar xvfz busybox-1.1.1.tar.gz
$</CCID_CODE /></PRE></TD></TR></TBODY></TABLE></CCID_NOBR /></CENTER>
<P style="TEXT-INDENT: 2em">结果会生成一个目录，名为 busybox-1.1.1，其中包含了 BusyBox 的源代码。要编译默认的配置（其中包含了几乎所有的内容，并禁用了调试功能），请使用 defconfig make 目标： </P>
<P style="TEXT-INDENT: 2em">清单 5. 编译默认的 BusyBox 配置 </P>
<P style="TEXT-INDENT: 2em">
<CENTER><CCID_NOBR />
<TABLE cellSpacing=0 borderColorDark=#ffffff cellPadding=2 width=400 align=center borderColorLight=#000000 border=1>
<TBODY>
<TR>
<TD class=code style="FONT-SIZE: 9pt" bgColor=#e6e6e6><PRE><CCID_CODE />$ cd busybox-1.1.1
$ make defconfig
$ make
$</CCID_CODE /></PRE></TD></TR></TBODY></TABLE></CCID_NOBR /></CENTER>
<P style="TEXT-INDENT: 2em">结果是一个相当大的 BusyBox 映像，不过这只是开始使用它的最简单的方法。我们可以直接调用这个新映像，这会产生一个简单的 Help 页面，里面包括当前配置的命令。要对这个映像进行测试，我们也可以对一个命令调用 BusyBox 来执行，如清单 6 所示。 </P>
<P style="TEXT-INDENT: 2em">清单 6. 展示 BusyBox 命令的执行和 BusyBox 中的 ash shell </P>
<P style="TEXT-INDENT: 2em">
<CENTER><CCID_NOBR />
<TABLE cellSpacing=0 borderColorDark=#ffffff cellPadding=2 width=400 align=center borderColorLight=#000000 border=1>
<TBODY>
<TR>
<TD class=code style="FONT-SIZE: 9pt" bgColor=#e6e6e6><PRE><CCID_CODE />$ ./busybox pwd
/usr/local/src/busybox-1.1.1
$ ./busybox ash
/usr/local/src/busybox-1.1.1 $ pwd
/usr/local/src/busybox-1.1.1
/usr/local/src/busybox-1.1.1 $ exit
$</CCID_CODE /></PRE></TD></TR></TBODY></TABLE></CCID_NOBR /></CENTER>
<P style="TEXT-INDENT: 2em">在这个例子中，我们调用了 pwd（打印工作目录）命令，使用 BusyBox 进入了 ash shell，并在 ash 中调用了 pwd。 </P>
<P style="TEXT-INDENT: 2em"><B>手工配置</B> </P>
<P style="TEXT-INDENT: 2em">如果您正在构建一个具有特殊需求的嵌入式设备，那就可以手工使用 menuconfig make 目标来配置 BusyBox 的内容。如果您熟悉 Linux 内核的编译过程，就会注意到 menuconfig 与配置 Linux 内核的内容所使用的目标相同。实际上，它们都采用了相同的基于 ncurses 的应用程序。 </P>
<P style="TEXT-INDENT: 2em">使用手工配置，我们可以指定在最终的 BusyBox 映像中包含的命令。我们也可以对 BusyBox 环境进行配置，例如包括对 NSA（美国国家安全代理）的安全增强 Linux（SELinux），指定要使用的编译器（用来在嵌入式环境中进行交叉编译）以及 BusyBox 应该静态编译还是动态编译。图 1 给出了 menuconfig 的主界面。在这里我们应该可以看到可以为 BusyBox 配置的不同类型的应用程序（applet）。 </P>
<P style="TEXT-INDENT: 2em">
<CENTER><IMG src="/Technology/UploadFiles_8326/200611/20061103002621389.jpg"></CENTER>
<P style="TEXT-INDENT: 2em">
<CENTER>图 1. 使用 menuconfig 配置 BusyBox</CENTER>
<P style="TEXT-INDENT: 2em"><B>多体系结构支持</B> </P>
<P style="TEXT-INDENT: 2em">可以简单地为 BusyBox 指定交叉编译器意味着我们可以为很多体系结构编译 BusyBox。要为您的目标体系结构编译 BusyBox，我们需要一个交叉编译器和一个已经为特定目标体系结构编译好的 C 库（uClibc 或 glibc）。 </P>
<P style="TEXT-INDENT: 2em">要手工配置 BusyBox，请使用下面的命令： </P>
<P style="TEXT-INDENT: 2em">清单 7. 手工配置 BusyBox </P>
<P style="TEXT-INDENT: 2em">
<CENTER><CCID_NOBR />
<TABLE cellSpacing=0 borderColorDark=#ffffff cellPadding=2 width=400 align=center borderColorLight=#000000 border=1>
<TBODY>
<TR>
<TD class=code style="FONT-SIZE: 9pt" bgColor=#e6e6e6><PRE><CCID_CODE />$ make menuconfig
$ make
$</CCID_CODE /></PRE></TD></TR></TBODY></TABLE></CCID_NOBR /></CENTER>
<P style="TEXT-INDENT: 2em">这为我们提供了可以调用的 BusyBox 的二进制文件。下一个步骤是围绕 BusyBox 构建一个环境，包括将标准 Linux 命令重定向到 BusyBox 二进制文件的符号链接。我们可以使用下面的命令简单地完成这个过程： </P>
<P style="TEXT-INDENT: 2em">清单 8. 构建 BusyBox 环境 </P>
<P style="TEXT-INDENT: 2em">
<CENTER><CCID_NOBR />
<TABLE cellSpacing=0 borderColorDark=#ffffff cellPadding=2 width=400 align=center borderColorLight=#000000 border=1>
<TBODY>
<TR>
<TD class=code style="FONT-SIZE: 9pt" bgColor=#e6e6e6><PRE><CCID_CODE />$ make install
$</CCID_CODE /></PRE></TD></TR></TBODY></TABLE></CENTER>
<P style="TEXT-INDENT: 2em">默认情况下，这会创建一个新的本地子目录 _install，其中包含了基本的 Linux 环境。在这个根目录中，您会找到一个链接到 BusyBox 的 linuxrc 程序。这个 linuxrc 程序在构建安装盘或急救盘（允许提前进行模块化的引导）时非常有用。同样是在这个根目录中，还有一个包含操作系统二进制文件的 /sbin 子目录。还有一个包含用户二进制文件的 /bin 目录。在构建软盘发行版或嵌入式初始 RAM 磁盘时，我们可以将这个 _install 目录迁移到目标环境中。我们还可以使用 make 程序的 PREFIX 选项将安装目录重定向到其他位置。例如，下面的代码就使用 /tmp/newtarget 根目录来安装这些符号链接，而不是使用 ./_install 目录： </P>
<P style="TEXT-INDENT: 2em">清单 9. 将符号链接安装到另外一个目录中 </P>
<P style="TEXT-INDENT: 2em">
<CENTER><CCID_NOBR />
<TABLE cellSpacing=0 borderColorDark=#ffffff cellPadding=2 width=400 align=center borderColorLight=#000000 border=1>
<TBODY>
<TR>
<TD class=code style="FONT-SIZE: 9pt" bgColor=#e6e6e6><PRE><CCID_CODE />$ make PREFIX=/tmp/newtarget install
$</CCID_CODE /></PRE></TD></TR></TBODY></TABLE></CCID_NOBR /></CENTER>
<P style="TEXT-INDENT: 2em">使用 install make 目标创建的符号链接都来自于 busybox.links 文件。这个文件是在编译 BusyBox 时创建的，它包含了已经配置的命令清单。在执行 install 时，就会检查 busybox.links 文件确定要创建的符号链接。 </P>
<P style="TEXT-INDENT: 2em">到 BusyBox 的命令行链接也可以使用 BusyBox 在运行时动态创建。CONFIG_FEATURE_INSTALLER 选项就可以启用这个特性，在运行时可以这样执行： </P>
<P style="TEXT-INDENT: 2em">清单 10. 在运行时创建命令链接 </P>
<P style="TEXT-INDENT: 2em">
<CENTER><CCID_NOBR />
<TABLE cellSpacing=0 borderColorDark=#ffffff cellPadding=2 width=400 align=center borderColorLight=#000000 border=1>
<TBODY>
<TR>
<TD class=code style="FONT-SIZE: 9pt" bgColor=#e6e6e6><PRE><CCID_CODE />$ ./busybox --install -s
$</CCID_CODE /></PRE></TD></TR></TBODY></TABLE></CCID_NOBR /></CENTER>
<P style="TEXT-INDENT: 2em">-s 选项强制创建这些符号链接（否则就创建硬链接）。这个选项要求系统中存在 /proc 文件系统。 </P>
<P style="TEXT-INDENT: 2em">BusyBox 编译选项 </P>
<P style="TEXT-INDENT: 2em">BusyBox 包括了几个编译选项，可以帮助为我们编译和调试正确的 BusyBox。 </P>
<P style="TEXT-INDENT: 2em">表 1. 为 BusyBox 提供的几个 make 选项 </P>
<P style="TEXT-INDENT: 2em">make目标 说明 </P>
<P style="TEXT-INDENT: 2em">
<CENTER><CCID_NOBR />
<TABLE cellSpacing=0 borderColorDark=#ffffff cellPadding=2 width=400 align=center borderColorLight=#000000 border=1>
<TBODY>
<TR>
<TD class=code style="FONT-SIZE: 9pt" bgColor=#e6e6e6><PRE><CCID_CODE />help	                 显示 make 选项的完整列表
defconfig	                 启用默认的（通用）配置
allnoconfig	        禁用所有的应用程序（空配置）
allyesconfig	        启用所有的应用程序（完整配置）
allbareconfig	        启用所有的应用程序，但是不包括子特性
config	                 基于文本的配置工具
menuconfig	                 N-curses（基于菜单的）配置工具
all	                 编译 BusyBox 二进制文件和文档（./docs）
busybox	                 编译 BusyBox 二进制文件
clean	                 清除源代码树
distclean	                 彻底清除源代码树
sizes	                 显示所启用的应用程序的文本/数据大小</CCID_CODE /></PRE></TD></TR></TBODY></TABLE></CCID_NOBR /></CENTER>
<P style="TEXT-INDENT: 2em">在定义配置时，我们只需要输入 make 就可以真正编译 BusyBox 二进制文件。例如，要为所有的应用程序编译 BusyBox，我们可以执行下面的命令： </P>
<P style="TEXT-INDENT: 2em">清单 11. 编译 BusyBox 二进制程序 </P>
<P style="TEXT-INDENT: 2em">
<CENTER><CCID_NOBR />
<TABLE cellSpacing=0 borderColorDark=#ffffff cellPadding=2 width=400 align=center borderColorLight=#000000 border=1>
<TBODY>
<TR>
<TD class=code style="FONT-SIZE: 9pt" bgColor=#e6e6e6><PRE><CCID_CODE />$ make allyesconfig
$ make
$</CCID_CODE /></PRE></TD></TR></TBODY></TABLE></CENTER>
<P style="TEXT-INDENT: 2em"><B>压缩 BusyBox</B> </P>
<P style="TEXT-INDENT: 2em">如果您非常关心对 BusyBox 映像的压缩，就需要记住两件事情： </P>
<P style="TEXT-INDENT: 2em">1. 永远不要编译为静态二进制文件（这会将所有需要的库都包含到映像文件中）。相反，如果我们是编译为一个共享映像，那么它会使用其他应用程序使用的库（例如 /lib/libc.so.X）。 </P>
<P style="TEXT-INDENT: 2em">2. 使用 uClibc 进行编译，这是一个对大小进行过优化的 C 库，它是为嵌入式系统开发的；而不要使用标准的 glibc （GNU C 库）来编译。 </P>
<P style="TEXT-INDENT: 2em">BusyBox 命令中支持的选项 </P>
<P style="TEXT-INDENT: 2em">BusyBox 中的命令并不支持所有可用选项，不过这些命令都包含了常用的选项。如果我们需要知道一个命令可以支持哪些选项，可以使用 --help 选项来调用这个命令，如清单 12 所示。 </P>
<P style="TEXT-INDENT: 2em">清单 12. 使用 --help 选项调用命令 </P>
<P style="TEXT-INDENT: 2em">
<CENTER><CCID_NOBR />
<TABLE cellSpacing=0 borderColorDark=#ffffff cellPadding=2 width=400 align=center borderColorLight=#000000 border=1>
<TBODY>
<TR>
<TD class=code style="FONT-SIZE: 9pt" bgColor=#e6e6e6><PRE><CCID_CODE />$ ./busybox wc --help
BusyBox v1.1.1 (2006.04.09-15:27+0000) multi-call binary
Usage: wc [OPTION]... [FILE]...
Print line, word, and byte counts for each FILE, and a total line if
more than one FILE is specified. With no FILE, read standard input.
Options:
	-c	print the byte counts
	-l	print the newline counts
	-L	print the length of the longest line
	-w	print the word counts
$</CCID_CODE /></PRE></TD></TR></TBODY></TABLE></CCID_NOBR /></CENTER>
<P style="TEXT-INDENT: 2em">这些特定的数据只有在启用了 CONFIG_FEATURE_VERBOSE_USAGE 选项时才可以使用。如果没有这个选项，我们就无法获得这些详细数据，但是这样可以节省大约 13 KB 的空间。 </P>
<P style="TEXT-INDENT: 2em">向 BusyBox 中添加新命令 </P>
<P style="TEXT-INDENT: 2em">向 BusyBox 添加一个新命令非常简单，这是因为它具有良好定义的体系结构。第一个步骤是为新命令的源代码选择一个位置。我们要根据命令的类型（网络，shell 等）来选择位置，并与其他命令保持一致。这一点非常重要，因为这个新命令最终会在 menuconfig 的配置菜单中出现（在下面的例子中，是 Miscellaneous Utilities 菜单）。 </P>
<P style="TEXT-INDENT: 2em">对于这个例子来说，我将这个新命令称为 newcmd，并将它放到了 ./miscutils 目录中。这个新命令的源代码如清单 13 所示。 </P>
<P style="TEXT-INDENT: 2em">清单 13. 集成到 BusyBox 中的新命令的源代码 </P>
<P style="TEXT-INDENT: 2em">
<CENTER><CCID_NOBR />
<TABLE cellSpacing=0 borderColorDark=#ffffff cellPadding=2 width=400 align=center borderColorLight=#000000 border=1>
<TBODY>
<TR>
<TD class=code style="FONT-SIZE: 9pt" bgColor=#e6e6e6><PRE><CCID_CODE />#include "busybox.h"
int newcmd_main( int argc, char *argv[] )
{
  int i;
  printf("newcmd called:\n");
  for (i = 0 ; i &lt; argc ; i++) {
    printf("arg[%d] = %s\n", i, argv[i]);
  }
  return 0;
}</CCID_CODE /></PRE></TD></TR></TBODY></TABLE></CCID_NOBR /></CENTER>
<P style="TEXT-INDENT: 2em">接下来，我们要将这个新命令的源代码添加到所选子目录中的 Makefile.in 中。在本例中，我更新了 ./miscutils/Makefile.in 文件。请按照字母顺序来添加新命令，以便维持与现有命令的一致性： </P>
<P style="TEXT-INDENT: 2em">清单 14. 将命令添加到 Makefile.in 中 </P>
<P style="TEXT-INDENT: 2em">
<CENTER><CCID_NOBR />
<TABLE cellSpacing=0 borderColorDark=#ffffff cellPadding=2 width=400 align=center borderColorLight=#000000 border=1>
<TBODY>
<TR>
<TD class=code style="FONT-SIZE: 9pt" bgColor=#e6e6e6><PRE><CCID_CODE />MISCUTILS-$(CONFIG_MT)          += mt.o
MISCUTILS-$(CONFIG_NEWCMD)   += newcmd.o
MISCUTILS-$(CONFIG_RUNLEVEL)    += runlevel.o</CCID_CODE /></PRE></TD></TR></TBODY></TABLE></CCID_NOBR /></CENTER>
<P style="TEXT-INDENT: 2em">接下来再次更新 ./miscutils 目录中的配置文件，以便让新命令在配置过程中是可见的。这个文件名为 Config.in，新命令是按照字母顺序添加的： </P>
<P style="TEXT-INDENT: 2em">清单 15. 将命令添加到 Config.in 中 </P>
<P style="TEXT-INDENT: 2em">
<CENTER><CCID_NOBR />
<TABLE cellSpacing=0 borderColorDark=#ffffff cellPadding=2 width=400 align=center borderColorLight=#000000 border=1>
<TBODY>
<TR>
<TD class=code style="FONT-SIZE: 9pt" bgColor=#e6e6e6><PRE><CCID_CODE />config CONFIG_NEWCMD
	bool "newcmd"
	default n
	help
	  newcmd is a new test command</CCID_CODE /></PRE></TD></TR></TBODY></TABLE></CCID_NOBR /></CENTER>
<P style="TEXT-INDENT: 2em">这个结构定义了一个新配置项（通过 config 关键字）以及一个配置选项（CONFIG_NEWCMD）。新命令可以启用，也可以禁用，因此我们对配置的菜单属性使用了 bool （Boolean）值。这个命令默认是禁用的（n 表示 No），我们可以最后放上一个简短的 Help 描述。在源代码树的 ./scripts/config/Kconfig-language.txt 文件中，我们可以看到配置语法的完整文法。 </P>
<P style="TEXT-INDENT: 2em">接下来需要更新 ./include/applets.h 文件，使其包含这个新命令。将下面这行内容添加到这个文件中，记住要按照字母顺序。维护这个次序非常重要，否则我们的命令就会找不到。 </P>
<P style="TEXT-INDENT: 2em">清单 16. 将命令添加到 applets.h 中 </P>
<P style="TEXT-INDENT: 2em">
<CENTER><CCID_NOBR />
<TABLE cellSpacing=0 borderColorDark=#ffffff cellPadding=2 width=400 align=center borderColorLight=#000000 border=1>
<TBODY>
<TR>
<TD class=code style="FONT-SIZE: 9pt" bgColor=#e6e6e6><PRE><CCID_CODE />USE_NEWCMD(APPLET(newcmd, newcmd_main, _BB_DIR_USER_BIN, _BB_SUID_NEVER))</CCID_CODE /></PRE></TD></TR></TBODY></TABLE></CCID_NOBR /></CENTER>
<P style="TEXT-INDENT: 2em">这定义了命令名（newcmd），它在 Busybox 源代码中的函数名（newcmd_main），应该在哪里会为这个新命令创建链接（在这种情况中，它在 /usr/bin 目录中），最后这个命令是否有权设置用户 id（在本例中是 no）。 </P>
<P style="TEXT-INDENT: 2em">倒数第二个步骤是向 ./include/usage.h 文件中添加详细的帮助信息。正如您可以从这个文件的例子中看到的一样，使用信息可能非常详细。在本例中，我只添加了一点信息，这样就可以编译这个新命令了： </P>
<P style="TEXT-INDENT: 2em">清单 17. 向 usage.h 添加帮助信息 </P>
<P style="TEXT-INDENT: 2em">
<CENTER><CCID_NOBR />
<TABLE cellSpacing=0 borderColorDark=#ffffff cellPadding=2 width=400 align=center borderColorLight=#000000 border=1>
<TBODY>
<TR>
<TD class=code style="FONT-SIZE: 9pt" bgColor=#e6e6e6><PRE><CCID_CODE />#define newcmd_trivial_usage	"None"
#define newcmd_full_usage	"None"</CCID_CODE /></PRE></TD></TR></TBODY></TABLE></CCID_NOBR /></CENTER>
<P style="TEXT-INDENT: 2em">最后一个步骤是启用新命令（通过 make menuconfig，然后在 Miscellaneous Utilities 菜单中启用这个选项）然后使用 make 来编译 BusyBox。 </P>
<P style="TEXT-INDENT: 2em">使用新的 BusyBox，我们可以对这个新命令进行测试，如清单 18 所示。 </P>
<P style="TEXT-INDENT: 2em">清单 18. 测试新命令 </P>
<P style="TEXT-INDENT: 2em">
<CENTER><CCID_NOBR />
<TABLE cellSpacing=0 borderColorDark=#ffffff cellPadding=2 width=400 align=center borderColorLight=#000000 border=1>
<TBODY>
<TR>
<TD class=code style="FONT-SIZE: 9pt" bgColor=#e6e6e6><PRE><CCID_CODE />$ ./busybox newcmd arg1
newcmd called:
arg[0] = newcmd
arg[1] = arg1
$ ./busybox newcmd --help
BusyBox v1.1.1 (2006.04.12-13:47+0000) multi-call binary

Usage: newcmd None

None</CCID_CODE /></PRE></TD></TR></TBODY></TABLE></CCID_NOBR /></CENTER>
<P style="TEXT-INDENT: 2em">就是这样！BusyBox 开发人员开发了一个优秀但非常容易扩展的工具。 </P>
<P style="TEXT-INDENT: 2em"><B>结束语</B> </P>
<P style="TEXT-INDENT: 2em">BusyBox 是为构建内存有限的嵌入式系统和基于软盘系统的一个优秀工具。BusyBox 通过将很多必需的工具放入一个可执行程序，并让它们可以共享代码中相同的部分，从而对它们的大小进行了很大程度的缩减，BusyBox 对于嵌入式系统来说是一个非常有用的工具，因此值得我们花一些时间进行探索。</P> 
      <CENTER></CENTER></td>
    </tr>
    <tr>
      <td class=Article_tdbgall align=right colSpan=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<FONT color=#0089f7>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<FONT style="BACKGROUND-COLOR: #f5f5f5" color=#000000>欢迎点击进入：</FONT><A title="" href="http://www.tichinese.com/"><U><FONT color=#0033ff>TI德州中文网</FONT></U></A><FONT color=#0089f7>&nbsp;&nbsp;</FONT><FONT color=#ff0000> (国内唯一针对TI应用的中文技术网站)</FONT>&nbsp;&nbsp;&nbsp; </FONT>文章录入：admin&nbsp;&nbsp;&nbsp;&nbsp;责任编辑：admin&nbsp;</td>
    </tr>
    <tr>
      <td width=5></td>
      <td width=752><li>上一篇文章： <a class='LinkPrevArticle' href='/Technology/embed/200611/8074.html' title='文章标题：中国嵌入式产业关键环节是标准和协作
作&nbsp;&nbsp;&nbsp;&nbsp;者：61IC录入
更新时间：2006-11-3 0:25:21'>中国嵌入式产业关键环节是标准和协作</a></li><BR><li>下一篇文章： <a class='LinkNextArticle' href='/Technology/embed/200611/8076.html' title='文章标题：必看：嵌入式系统及系统级可编程产品
作&nbsp;&nbsp;&nbsp;&nbsp;者：61IC录入
更新时间：2006-11-3 0:26:37'>必看：嵌入式系统及系统级可编程产品</a></li></td>
    </tr>
    <tr class=Article_tdbgall align=right>
      <td colSpan=2>【<a href="/Technology/Comment.asp?ArticleID=8075" target="_blank">发表评论</a>】【<a href="/User/User_Favorite.asp?Action=Add&ChannelID=1024&InfoID=8075" target="_blank">加入收藏</a>】【<a href="/Technology/SendMail.asp?ArticleID=8075" target="_blank">告诉好友</a>】【<a href="/Technology/Print.asp?ArticleID=8075" target="_blank">打印此文</a>】【<a href="javascript:window.close();">关闭窗口</a>】</td>
    </tr>
  </table>
  <table class=center_tdbgall cellSpacing=0 cellPadding=0 width=760 align=center border=0>
    <tr>
      <td class=main_shadow>
      </td>
    </tr>
  </table>
  <!--文章显示代码结束-->
  <!--最新热点、最新推荐、相关文章代码开始-->
  <table class=center_tdbgall style="WORD-BREAK: break-all" cellSpacing=0 cellPadding=0 width=760 align=center border=0>
    <tr>
      <td class=main_title_282 width="33%"><B>最新热点</B></td>
      <td width=5 rowSpan=2></td>
      <td class=main_title_282 width="33%"><B>最新推荐</B></td>
      <td width=5 rowSpan=2></td>
      <td class=main_title_282 width="33%"><B>相关文章</B></td>
    </tr>
    <tr>
      <td class=main_tdbg_760 vAlign=top height=100>
      <script language="javascript" src="/Technology/JS/Article_Hot3.js"></script></td>
      <td class=main_tdbg_760 vAlign=top width="33%">
      <script language="javascript" src="/Technology/JS/Article_Elite3.js"></script></td>
      <td class=main_tdbg_760 vAlign=top width="33%"><a class='LinkArticleCorrelative' href='/Technology/embed/200801/18110.html' title='文章标题：“硬实时”为Linux注入新活力
作&nbsp;&nbsp;&nbsp;&nbsp;者：美国风河系统公司
更新时间：2008-1-3 12:08:40' target="_self">“硬实时”为Linux注入新活力</a><br><a class='LinkArticleCorrelative' href='/Technology/Communicate/200712/17355.html' title='文章标题：基于Linux的EPA无线通信卡的实现
作&nbsp;&nbsp;&nbsp;&nbsp;者：王军 王宏 徐皑冬 周侗 谭彩虹
更新时间：2007-12-6 11:06:29' target="_self">基于Linux的EPA无线通信卡的…</a><br><a class='LinkArticleCorrelative' href='/Technology/embed/200711/17122.html' title='文章标题：基于Linux的红外网络通信的实现
作&nbsp;&nbsp;&nbsp;&nbsp;者：周亦敏 佟国香
更新时间：2007-11-19 5:40:20' target="_self">基于Linux的红外网络通信的实…</a><br><a class='LinkArticleCorrelative' href='/Technology/embed/200711/16945.html' title='文章标题：基于Linux系统的软PLC设计
作&nbsp;&nbsp;&nbsp;&nbsp;者：李坚强 裴海龙 廖俊
更新时间：2007-11-6 8:39:38' target="_self">基于Linux系统的软PLC设计</a><br><a class='LinkArticleCorrelative' href='/Technology/EDA/200710/16673.html' title='文章标题：基于嵌入式Linux的&nbsp;TFT&nbsp;LCD&nbsp;IP及驱动的设计
作&nbsp;&nbsp;&nbsp;&nbsp;者：李丰旺 刘小平
更新时间：2007-10-15 9:26:51' target="_self">基于嵌入式Linux的&nbsp;TFT&nbsp;LCD&nbsp;…</a><br><a class='LinkArticleCorrelative' href='/Technology/embed/200709/16141.html' title='文章标题：Linux多线程编程和Linux&nbsp;2.6下的NPTL
作&nbsp;&nbsp;&nbsp;&nbsp;者：Free
更新时间：2007-9-12 13:50:40' target="_self">Linux多线程编程和Linux&nbsp;2.6…</a><br><a class='LinkArticleCorrelative' href='/Technology/embed/200709/16140.html' title='文章标题：Linux下的多线程编程
作&nbsp;&nbsp;&nbsp;&nbsp;者：Free
更新时间：2007-9-12 13:48:08' target="_self">Linux下的多线程编程</a><br><a class='LinkArticleCorrelative' href='/Technology/embed/200709/15931.html' title='文章标题：基于2.6.19内核的小型Linux系统制作与移植
作&nbsp;&nbsp;&nbsp;&nbsp;者：梁千帆 陈建华 孔凡军
更新时间：2007-9-5 13:00:33' target="_self">基于2.6.19内核的小型Linux系…</a><br><a class='LinkArticleCorrelative' href='/Technology/embed/200708/15634.html' title='文章标题：基于嵌入式Linux的接口转换卡设计
作&nbsp;&nbsp;&nbsp;&nbsp;者：李晓丽 黄建国 李力
更新时间：2007-8-26 17:15:48' target="_self">基于嵌入式Linux的接口转换卡…</a><br><a class='LinkArticleCorrelative' href='/Technology/embed/200705/14105.html' title='文章标题：Linux2.4与Linux2.6内核调度器的比较研究
作&nbsp;&nbsp;&nbsp;&nbsp;者：叶超 郭立红 邹荣士
更新时间：2007-5-18 10:07:54' target="_self">Linux2.4与Linux2.6内核调度…</a><br></td>
    </tr>
  </table>
  <table class=center_tdbgall cellSpacing=0 cellPadding=0 width=760 align=center border=0>
    <tr>
      <td class=main_shadow></td>
    </tr>
  </table>
  <!--最新热点、最新推荐、相关文章代码结束-->
  <!--网友评论代码开始-->
  <table class=center_tdbgall style="WORD-BREAK: break-all" cellSpacing=0 cellPadding=0 width=760 align=center border=0>
    <tr class=main_title_760>
      <td height=25>　　<STRONG>网友评论：</STRONG><SPAN style="COLOR: #ff0000">（只显示最新10条。评论内容只代表网友观点，与本站立场无关！） </SPAN></td>
    </tr>
    <tr>
      <td class=main_tdbg_760>
      <script language="javascript" src="/Technology/Comment.asp?Action=JS&CommentNum=10&ArticleID=8075"></script></td>
    </tr>
  </table>
  <table class=center_tdbgall cellSpacing=0 cellPadding=0 width=760 align=center border=0>
    <tr>
      <td class=main_shadow></td>
    </tr>
  </table>
  <!--网友评论代码结束-->
  <!-- ********网页中部代码结束******** -->
  <!-- ********网页底部代码开始******** --><table cellSpacing=0 cellPadding=0 width=778 align=center border=0>
    <tr>
      <td class=menu_bottombg align=middle>| <A class=Bottom onclick="this.style.behavior='url(#default#homepage)';this.setHomePage('http://www.61ic.com/');" href="#">设为首页</A> | <A class=Bottom href="javascript:window.external.addFavorite('http://www.61ic.com/','61IC中国电子在线');">加入收藏</A> | <A class=Bottom href="mailto:web_61ic@163.com">联系站长</A> | <A class=Bottom href="/FriendSite/Index.asp" target=_blank>友情链接</A> | <A class=Bottom href="/Copyright.asp" target=_blank>版权申明</A> | <A class=Bottom href="/Announcelist.asp" target=_blank>网站公告</A> |  <a class='Bottom' href='/Admin/Admin_Index.asp' target='_blank'>管理登录</a>&nbsp;|&nbsp;</td>
    </tr>
    <tr>
      <td class=bottom_bg height=80>
        <table cellSpacing=0 cellPadding=0 width="90%" align=center border=0>
          <tr>
            <td><IMG height=80 src="/Skin/Ocean/bottom_left.gif" width=9></td>
            <td align=middle width="80%"><a href="http://www.hngawj.net:80/" target="_blank"><img src="http://down.61ic.com/hngawj/d.gif" width="44" height="45" border="0"/></a><a href="http://www.hngawj.net:80/public/record/welcome.jsp?num=4302000100001" target="_blank"><img src="http://down.61ic.com/hngawj/logo.png" width="35" height="45" border="0"/></a> 站长：<A href="mailto:web_61ic@163.com">61IC 湘ICP备05002478号</A> </td>
            <td align=right><IMG height=80 src="/Skin/Ocean/bottom_r.gif" width=9></td>
          </tr>
        </table>
      </td>
    </tr>
  </table> 
  <!-- ********网页底部代码结束******** --><NOSCRIPT><IFRAME src='*' Width='0' Height='0'></IFRAME></NOSCRIPT>
</body>
</html>