#include "ip_filter.h"#include "ip_link.h"#include "../project/types.h"//函数功能：从文件中读取防火墙信息，依次存入链表中void read_firewall(ROU *router){		router->fd = open("../filt_file/fire.txt",O_RDWR|O_CREAT,0777);//打开文件  如有此文件：打开  没有：重建	if(router->fd == -1)	{		perror("open");	}	unsigned char buf_read[1024] = "";	bzero(buf_read,sizeof(buf_read));	if(read(router->fd,buf_read,sizeof(buf_read)) == 0)//从问文件中读取数据	{		return ;	}			/*分割数据段*/	unsigned char *result[50];	int num = 0;	result[num] = strtok(buf_read,";");//按  ; 分割数据	while(result[num] != NULL)	{		num++;		result[num] = strtok(NULL,";");	}			//将数据循环插入链表中	int i = 0;	for(i=0;i<num;i++)	{		router->filt_link_new = (FILT_LINK*)malloc(sizeof(FILT_LINK));		sprintf(router->filt_link_new->filt_str,"%s",result[i]);		filt_link_create(&router->filt_link_head, router->filt_link_new);//插入链表	}	close(router->fd);//关闭文件}//函数功能：从链表中读取防火墙信息并依次写入到文件中void write_firewall(ROU * router){	remove("../filt_file/fire.txt");	router->fd = open("../filt_file/fire.txt",O_WRONLY|O_CREAT,0777);//打开文件  如有此文件：打开  没有：重建	FILT_LINK *p = router->filt_link_head;		//将链表中的数据循环写入到文件中	unsigned char buf[200] = "";	while(p!=NULL)	{		bzero(buf,sizeof(buf));		sprintf(buf,"%s;",p->filt_str);//并以 ; 做分割 		write(router->fd,buf,strlen(buf));		p=p->next;	}	close(router->fd);//关闭文件}