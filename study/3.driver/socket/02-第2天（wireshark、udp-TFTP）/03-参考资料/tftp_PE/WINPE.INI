//配置文件开始
TEAM TEXT WINIPE is %WINIPE%
FIND MEM>125,LOGO %WINIPE%\WINIPE\桌面背景\PELOGO.JPG|WAIT 1250
TEAM TEXT 正在执行基本设置……#0xEE,$20|WAIT 500

_SUB Outer_Reload
	ENVI Programs=%USERPROFILE%\「开始」菜单\程序
	ENVI Desktop=%USERPROFILE%\桌面
	ENVI QuickLaunch=%USERPROFILE%\Application Data\Microsoft\Internet Explorer\Quick Launch
	IFEX %Desktop%\加载外部配置.LNK,FILE %Desktop%\加载外部配置.LNK
_END
//由最小模式启动后加载外置时，需要调用 Outer_Reload 中定义的一些命令
FIND Explorer.EXE,CALL Outer_Reload

ENVI CurDir=%WINIPE%\WINIPE
USER 老九 WinPE,扬州烟花三月纪念版
WALL %CurDir%\桌面背景\PEWallPaper.JPG

//对于笔记本键盘，可以去掉下面命令的注释，以避免打开数字键
//NUMK 0

//在桌面显示网上邻居
REGI HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\HideDesktopIcons\ClassicStartMenu\{208D2C60-3AEA-1069-A2D7-08002B30309D}=#0

//清理掉上次启动 PE 或 Windows 时留下的虚拟内存页面文件
ENVI PF=Pagefile.sys
TEAM FILE C:\%PF%|FILE D:\%PF%|FILE E:\%PF%|FILE F:\%PF%|FILE G:\%PF%|FILE H:\%PF%|FILE I:\%PF%|FILE J:\%PF%|FILE K:\%PF%|FILE L:\%PF%|FILE M:\%PF%|FILE N:\%PF%|FILE O:\%PF%|FILE P:\%PF%|FILE Q:\%PF%|FILE R:\%PF%|FILE S:\%PF%|FILE T:\%PF%

_SUB IFSetPageFile
	TEAM TEXT 是否设置虚拟内存？|ENVI YESNO=YES
	MESS 您的计算机物理内存较少，某些WINIPE的运行可能需要用到\n虚拟内存。设置了虚拟内存，有助于提高系统的速度和稳定性；\n如果您需要保护并恢复硬盘分区数据，可跳过虚拟内存的设置。\n \n您确定要设置虚拟内存吗？（建议设置，30 秒后默认选择否）@设置虚拟内存 #YN *30000
	IFEX $YESNO=YES,Call SetPageDrv!TEXT 没有建立虚拟内存……
	WAIT 500
_END
_SUB SetPageDrv
	TEAM TEXT 正在设定虚拟内存……|ENVI $TARGET_ROOT=
	BROW %SystemRoot% $请选择虚拟内存文件存放的分区，取消则自动选择分区
	IFEX $TARGET_ROOT=,TEXT 正在设定虚拟内存(自动选择存放分区)……|PAGE D:\%PF% 192 256!TEXT 正在设定虚拟内存(虚拟内存存放在 %TARGET_DRIVE% 盘)……|PAGE %TARGET_DRIVE%\%PF% 192 256
_END

//物理内存低于 256MB 时询问是否取消设定虚拟内存
FIND MEM<256,CALL IFSetPageFile

//挂接硬盘上 Windows 系统的字体，如果因字体过多造成启动极其缓慢或无法启动，请关闭下面的命令
//FONT C:\WINDOWS\Fonts

TEXT 正在加载WINIPE……

//建立WINIPE加载的可行性报告，如果设置了虚拟内存或者可用内存大于一定数值，则加载有关的外置组件
TEAM EXEC !=CMD.EXE /C ECHO FOR %%I IN (C D E F G H I J K L M N O P Q R S T) DO IF EXIST %%I:\PAGEFILE.SYS PECMD LINK %Temp%\RPT_OK,%SystemRoot%>%TEMP%\RPT_OK.CMD|EXEC !=%TEMP%\RPT_OK.CMD

//设置自解压包的运行条件，如设置了虚拟内存，则建立运行条件，否则根据可用内存大小设置不同的运行条件
IFEX %Temp%\RPT_OK.LNK,LINK %Temp%\RPT_OK60,%SystemRoot%!IFEX MEM>60,LINK %Temp%\RPT_OK60,%SystemRoot%

//如果设置了虚拟内存或可用内存大于 120MB，则下面的命令组为无阻塞运行，否则则是排队执行
ENVI IFWait==
IFEX %Temp%\RPT_OK.LNK,ENVI IFWait=!IFEX MEM>120,ENVI IFWait=

EXEC =%CurDir%\PE_OuterPart\Outer_Base.EXE
//如果 X: 盘有足够剩余空间，则按照一定条件执行下面的WINIPE，是否为无阻塞运行则由上面的条件自动判定
IFEX %SystemDrive%\>10,IFEX %Temp%\RPT_OK60.LNK,EXEC =%CurDir%\WinRAR\WinRAR.EXE
IFEX %SystemDrive%\>10,IFEX %Temp%\RPT_OK60.LNK,EXEC =%CurDir%\FREEWB\FREEWB.EXE
IFEX %SystemDrive%\>20,IFEX %Temp%\RPT_OK60.LNK,EXEC %IFWait%%CurDir%\PE_OuterPart\MMC.EXE
IFEX %SystemDrive%\>10,IFEX %Temp%\RPT_OK60.LNK,EXEC %IFWait%%CurDir%\PE_OuterPart\Outer_Common.exe
_SUB InstallIE
	IFEX %Temp%\RPT_OK60.LNK,EXEC %IFWait%%CurDir%\IE6.0\IE6_Setup.EXE!LINK %Desktop%\安装IE,%CurDir%\IE6.0\IE6_Setup.EXE
_END
IFEX %SystemDrive%\>20,CALL InstallIE

//将常用文档与对应WINIPE建立关联
EXEC !%CurDir%\REGDOC.CMD

//创建一些WINIPE的快捷方式
LINK %Desktop%\安装 PE 镜像到硬盘,%WINIPE%\WINPE安装\安装.EXE
LINK !%Desktop%\启用网络支持,%CurDir%\PE_OUTERPART\Start_Net.CMD,,%CurDir%\PE_OUTERPART\NET_PART.EXE
LINK !%Desktop%\启用声音支持,%CurDir%\PE_OUTERPART\Start_Sound.CMD,,%CurDir%\PE_OUTERPART\SOUND_PART.EXE

LINK %QuickLaunch%\清理临时文件,%CurDir%\WinPE_TOOLS\CLEANTEMP.EXE
LINK %QuickLaunch%\设置虚拟内存,%CurDir%\WinPE_TOOLS\SETPAGEFILE.EXE

LINK %Programs%\Windows 系统维护\Windows用户密码修复,%CurDir%\WinPE_TOOLS\PasswdRenew.EXE
LINK %Programs%\Windows 系统维护\Windows安装助手,%CurDir%\WinPE_TOOLS\SETUPXP.EXE
LINK %Programs%\Windows 系统维护\Windows注册表编辑器,%CurDir%\WinPE_TOOLS\RUNSCANNER.EXE,%SystemRoot%\regedit.exe
LINK %Programs%\Windows 系统维护\Windows服务驱动管理器,%CurDir%\WinPE_TOOLS\SERVICESPE.EXE
LINK %Programs%\Windows 系统维护\Windows系统还原,%CurDir%\WinPE_TOOLS\SYSTEMRESTORE.EXE

LINK !%Programs%\卡巴斯基\卡巴斯基6（X盘需23M空间）,%CurDir%\AVP6\AVP6.CMD,,%CurDir%\AVP6\AVP.ICO
LINK !%Programs%\卡巴斯基\卡巴斯基6（在C盘运行）,%CurDir%\AVP6\AVP6.CMD,C,%CurDir%\AVP6\AVP.ICO
LINK !%Programs%\卡巴斯基\卡巴斯基6（在D盘运行）,%CurDir%\AVP6\AVP6.CMD,D,%CurDir%\AVP6\AVP.ICO
LINK !%Programs%\卡巴斯基\卡巴斯基6（在E盘运行）,%CurDir%\AVP6\AVP6.CMD,E,%CurDir%\AVP6\AVP.ICO

LINK %Programs%\磁盘光盘工具\磁盘分区管理 WinPM,%CurDir%\WinPM\WinPM.exe
LINK %Programs%\磁盘光盘工具\Virtual Drive Manager,%CurDir%\VDM\VDM1.exe
LINK %Programs%\磁盘光盘工具\虚拟驱动器专家,%CurDir%\VDM\VDM2.exe
LINK %Programs%\磁盘光盘工具\光盘映像工具 UltraISO V8.51,%CurDir%\ULTRAISO\ULTRAISO.exe
LINK %Programs%\磁盘光盘工具\诺顿磁盘医生 NDD2006,%CurDir%\NDD2006\NDD32.exe
LINK %Programs%\磁盘光盘工具\微软虚拟光驱VCDTOOL,%CurDir%\MSVCD\VCDTOOL.EXE
LINK %Programs%\磁盘光盘工具\磁盘映像工具 WinImage V8.0,%CurDir%\WINIMAGE\WINIMAGE.exe
LINK %Programs%\磁盘光盘工具\PTDD 磁盘分区表医生,%CurDir%\ptdd3.0\PTDD3.0.EXE

LINK %Programs%\克隆工具\诺顿 Ghost32,%CurDir%\Ghost8\Ghost32.exe
LINK %Programs%\克隆工具\Gho映像浏览器 GhostExp,%CurDir%\GHOST8\GHOSTEXP.exe
LINK %Programs%\克隆工具\Acronis TrueImage ES 9.1,%CurDir%\ACRONIS\TRUEIMAGE.exe

LINK %Programs%\文件工具\文件解压 WinRAR V3.61,%ProgramFiles%\WINRAR\WINRAR.EXE
LINK %Programs%\文件工具\文件编辑 UltraEdit-32,%CurDir%\ULTRAEDIT\uedit32.exe
LINK %Programs%\文件工具\文件恢复 FinalData,%CurDir%\FINALDATA\FINALDATA.exe

LINK %Programs%\图片、PDF工具\看图工具 ACDSee,%CurDir%\ACDSEE\ACDSEE.exe
LINK %Programs%\图片、PDF工具\PDF查看 FoxitReader,%CurDir%\FoxitReader\FoxitReader.exe
LINK %Programs%\图片、PDF工具\截图工具 HyperSnap,%CurDir%\HyperSnap6\HprSnap6.exe

LINK %Programs%\系统检测\硬件及系统环境检测 Everest,%CurDir%\系统检测\EVEREST\EVEREST.exe
LINK %Programs%\系统检测\CPU 检测（CPU-Z）,%CurDir%\系统检测\CPUZ\CPUZ.exe
LINK %Programs%\系统检测\显示器测试工具（DisplayX）,%CurDir%\系统检测\DisplayX\DisplayX.exe
LINK %Programs%\系统检测\数码相机 CCD 坏点检测,%CurDir%\系统检测\CCD坏点检测\CCD_CHECK.EXE
LINK %Programs%\系统检测\物理内存检测器（MemTest）,%CurDir%\系统检测\MEMTEST\MEMTEST.EXE
LINK %Programs%\系统检测\经典测试工具 SuperPI MOD,%CurDir%\系统检测\super_pi\super_pi.exe
LINK %Programs%\系统检测\ATTO 磁盘性能测试,%CurDir%\系统检测\ATTO\DISK_BENCH32.EXE
LINK %Programs%\系统检测\Filemon 文件监视程序,%CurDir%\系统检测\Filemon\Filemon.exe
LINK !%Programs%\系统检测\系统快照工具（RegSnap）,%CurDir%\RegSnap\RegSnap.CMD,,%CurDir%\RegSnap\RegSnap.exe

LINK %Programs%\聊天下载工具\迅雷 V5.0,%CurDir%\THUNDER\THUNDER5.0.EXE
LINK %Programs%\聊天下载工具\迷你QQ,%CurDir%\MINIQQ\MINIQQ.EXE

LINK %Programs%\影音播放\千千静听,%CurDir%\影音播放\千千静听.exe
LINK %Programs%\影音播放\MPlayer,%CurDir%\影音播放\mplayer.exe

LINK %Programs%\网络设置\局域网查看工具（LanSee）,%CurDir%\WinPE_TOOLS\LANSEEV1.59.exe

LINK %Programs%\附件\微软中国日历,%CurDir%\微软中国日历\ICALCLK.EXE
LINK %Programs%\附件\画图,%SystemRoot%\System32\MSPAINT.EXE
LINK %Programs%\附件\计算器,%SystemRoot%\System32\CALC.EXE

_SUB IfSetDisplay
	TEAM TEXT 3 秒钟内按住 Ctrl 键忽略显卡驱动安装……|WAIT 3000
	FIND KEY=17,!Call SetDisplay
_END
_SUB SetDisplay
	TEAM EXEC !%CurDir%\PE_OuterPart\Start_VGA.CMD DISP W1024 H768 B16 F75|FILE %Desktop%\启用显卡支持.*
_END
//物理内存达到 128MB 或者设置了虚拟内存，则自动加载显卡驱动，否则仅在桌面生成一个“启用显卡支持”的快捷方式
LINK !%Desktop%\启用显卡支持,%CurDir%\PE_OUTERPART\Start_VGA.CMD,,%CurDir%\PE_OUTERPART\Outer_Base.EXE
FIND MEM>127,Call IfSetDisplay!IFEX %Temp%\RPT_OK.LNK,Call IfSetDisplay

TEAM ENVI PF=|ENVI IFWait=|ENVI $TARGET_ROOT=|FILE %Temp%\RPT_*.*
FIND Explorer.EXE,!TEXT 正在载入桌面……|SHEL %SystemRoot%\EXPLORER.EXE|LOGO|TEXT
//配置文件结束